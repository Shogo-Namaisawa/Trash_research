---
title: "Eye_Effect_Verification"
author: "SHOGO NAMAISAWA"
date: "2024-11-24"
output: html_document
---

# ナッジを活用した目のイラストによるゴミの分別促進に関する効果検証

#### ライブラリの読み込み
```{r}
#install.packages("pacman")
pacman::p_load(
  tidyverse,
  ggplotgui,#ggplot_shiny(exdataset)をコンソールに打ち込んで実行する
  GGally,
  broom,
  knitr,
  kableExtra,
  sjPlot
)
```

#### 分析データ読み込み
```{r}
#データ読み込み
Data <- read_csv("../trash_data/AllData_trash.csv") 

#元々使わない３つの列は削除
AllData <- Data %>% 
  select(-...1, -ChooseHigh_Phrases1, -ChooseHigh_Phrases2, -ChooseHigh_Phrases3) %>%
  filter(SurvayType != "B1")
```

#### 分析に必要な4種類のSurvayTypeを抽出したdfを作成
```{r}
Eye_Illust_data <- AllData %>%
  # 目のイラストを比較するために必要なデータのみ抽出
  filter(SurvayType %in% c("C", "A1","A2","A4"))

Eye_Illust_data <- Eye_Illust_data %>%
  mutate(SurvayType = replace(SurvayType, SurvayType == "C", "絵なし")) %>%
  mutate(SurvayType = replace(SurvayType, SurvayType == "A1", "複雑な目")) %>%
  mutate(SurvayType = replace(SurvayType, SurvayType == "A2", "女性の目")) %>%
  mutate(SurvayType = replace(SurvayType, SurvayType == "A4", "簡単な目"))


# C案（イラストがNo_image）がInterceptになるように調整
Eye_Illust_data$SurvayType <- factor(Eye_Illust_data$SurvayType, levels = c("絵なし", "女性の目", "簡単な目", "複雑な目"))
```


#### ポスター案ごとの平均値と欠損値の確認
```{r}
str(Eye_Illust_data)
```

```{r}
summary_by_survay <- Eye_Illust_data %>%
  #ポスター案ごとのグループ化
  group_by(SurvayType) %>%
  #ポスター案別のポスタースコア平均
  summarise(
    count = n(),
    Score_mean = round(mean(PosterScore), 2),
    Score_sd = round(sd(PosterScore), 2),
    Score_se = round(sd(PosterScore) / sqrt(n()), 2),
    Score_median = round(median(PosterScore), 2),
    Score_IQR = round(IQR(PosterScore), 2),
    Survay_Q1 = round(quantile(PosterScore, 0.25), 2),
    Survay_Q3 = round(quantile(PosterScore, 0.75), 2),
    Score_min = min(PosterScore),
    Score_max = max(PosterScore),
    male = sum(Sex == "male"),
    female = sum(Sex == "female"),
    other = sum(Sex == "other"))


summary_by_survay
```

### summaryを表にまとめやすく
```{r}
library(knitr)
# 表形式で表示
# この出力結果をエクセルにぶっぱなす！
kable(summary_by_survay)
```

### table1を表にしてまとめやすく
```{r}
library(table1)
table1(~ factor(Sex) + PosterScore | SurvayType, data = Eye_Illust_data)
```

### 記述統計量
```{r}
# skimrパッケージをインストール・読み込み
library(skimr)
# skim関数を使用
skim(Eye_Illust_data)

```


```{r}
library(psych)
describeBy(Eye_Illust_data, group = Eye_Illust_data$SurvayType)
```


### 正規性の検定(Shapiro-Wilk test)

H0)それぞれの`SurvayType`における`PosterScore`の分布は正規分布に従う。

H1)それぞれの`SurvayType`における`PosterScore`の分布は正規分布に従うというわけではない。
```{r}

#SurvayTypeごとの正規性検定
tapply(Eye_Illust_data$PosterScore, Eye_Illust_data$SurvayType, shapiro.test)
```

データの正規性と等分散性を検討するため、シャピロ・ウィルク検定を実施した。シャピロ・ウィルク検定の結果、全てのグループで正規性が否定された（p < 0.05）。この結果から、データは正規分布の仮定を満たしていないと判断し、一元配置分散分析（ANOVA）の仮定が満たされていないため、非パラメトリック手法であるクラスカル・ウォリス検定を適用した。



### 等分散性の検定(Levene's test)
```{r}
#install.packages("car")  # 初回のみ
library(car) #等分散性の検定(Levene's test)
```

```{r}
# ルビーンの検定の実施
levene_result <- leveneTest(Eye_Illust_data$PosterScore ~ Eye_Illust_data$SurvayType, Eye_Illust_data)
print(levene_result)
```


### ４つのグループにおける差の検定(Kruskal-Wallis test)
```{r}
# クラスカル・ウォリス検定の実施
kruskal_result <- kruskal.test(Eye_Illust_data$PosterScore ~ Eye_Illust_data$SurvayType)


# 結果の表示
print(kruskal_result)
```


### グループ間における事後検定(Bonferroni correction)
```{r}
pairwise.wilcox.test(x = Eye_Illust_data$PosterScore, g=Eye_Illust_data$SurvayType, paired=F, p.adjust.method="holm")#ほるむに変える
```





